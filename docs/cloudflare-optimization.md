# Cloudflare Workers Optimization for Maskom

This document outlines the optimized configuration for the Maskom project deployed on Cloudflare Workers using Wrangler.

## Key Optimizations

1. **Enhanced Compatibility**: Updated compatibility date to 2025-01-01 and maintained necessary compatibility flags (`nodejs_compat`, `global_fetch_strictly_public`) for Next.js compatibility.

2. **Environment-Specific Configurations**: Added configurations for development, preview, and production environments with appropriate environment variables.

3. **Routing Configuration**: Added route patterns for handling requests to different domains (`maskom.co.id` and `www.maskom.co.id`).

4. **Asset Handling**: Properly configured asset handling through the `.open-next/assets` directory with `ASSETS` binding.

5. **Global Environment Variables**: Set up environment variables that apply across all environments.

## Configuration Details

### Main Settings
- **name**: Set to "maskom" for clear identification
- **main**: Points to ".open-next/worker.js" which is generated by OpenNext for Next.js compatibility
- **compatibility_date**: Updated to "2025-01-01" to benefit from latest runtime features
- **compatibility_flags**: Maintains compatibility with Node.js APIs and fetch behavior

### Build Configuration
- **command**: "npm run build" to ensure proper build before deployment

### Environment Variables
- **NODE_ENV**: Set appropriately for each environment (development, preview, production)
- **MCP_ENABLED**: Enabled for Model Context Protocol support
- **MCP_API_URL**: Configured for MCP functionality

### Route Configuration
- Production routes configured for both `maskom.co.id` and `www.maskom.co.id`
- Zone IDs need to be updated with actual values before deployment

### Domain Setup Instructions
1. In your Cloudflare dashboard, add and verify your domain (maskom.co.id)
2. Note down the Zone ID for your domain from the Cloudflare dashboard
3. Update the `wrangler.toml` file with your actual Zone ID:
   ```toml
   [[env.production.routes]]
   pattern = "www.maskom.co.id/*"
   zone_id = "your-actual-zone-id-here"
   
   [[env.production.routes]]
   pattern = "maskom.co.id/*"
   zone_id = "your-actual-zone-id-here"
   ```
4. In your domain registrar, update nameservers to point to Cloudflare as instructed in the Cloudflare dashboard
5. Ensure DNS settings are properly configured to point to your Workers application

## Deployment Instructions

1. Replace `your-account-id-here` with your actual Cloudflare account ID
2. Replace `your-zone-id-here` with your actual zone ID
3. Uncomment and configure route patterns before production deployment
4. Run `npm run deploy` to build and deploy the project

## Additional Bindings (Optional)

The configuration includes commented sections for:
- Durable Objects
- KV Namespaces
- R2 Buckets
- D1 Databases

These can be uncommented and configured as needed for additional functionality.

## Notes
- This configuration is optimized for Next.js projects using OpenNext
- The assets directory is properly configured for static asset handling
- Environment-specific settings allow for different configurations across dev/preview/prod